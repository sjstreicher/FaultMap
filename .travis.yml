language: python
python:
  - "2.7"
virtualenv:
    system_site_packages: true

before_install:
  # 
  - sudo apt-get update -qq
  - sudo apt-get install -qq pkg-config default-jdk wget python python-{dev,pip} cython lib{freetype6,xft,png,xext,openblas,lapack,hdf5-serial}-dev gfortran
  # Install miniconda
  - wget http://repo.continuum.io/miniconda/Miniconda-latest-Linux-x86_64.sh -O miniconda.sh
  - chmod +x miniconda.sh
  - ./miniconda.sh -b
  - export PATH=/home/travis/miniconda/bin:$PATH
  - conda update --yes conda
  # The next couple lines fix a crash with multiprocessing on Travis and are not specific to using Miniconda
  - sudo rm -rf /dev/shm
  - sudo ln -s /run/shm /dev/shm

# Install packages
install:
  # install what we can from condas
  - conda install --yes python=$TRAVIS_PYTHON_VERSION `cat conda_requirements.txt`
  # install the rest using pip
  - pip install -r `grep -v -f conda_requirements.txt requirements.txt`
  
before_script:
  # Make directory for custom installs 
  - cd ~
  - sudo mkdir repos
  - cd repos
  # Install pathos
  - sudo git clone git://github.com/uqfoundation/pathos.git
  - cd pathos
  - sudo wget http://dev.danse.us/packages/pathos-0.1a1.tgz
  - sudo tar -xvzf pathos-0.1a1.tgz
  - sudo easy_install -f . pathos-0.1a1
  - sudo python setup.py install
  
  # Install pyunicorn
  - cd ~/repos
  - sudo wget https://www.dropbox.com/s/s5giot81t87h8h4/pyunicorn-0.3.2.tar.gz
  - sudo tar -xvzf pyunicorn-0.3.2.tar.gz
  - cd pyunicorn-0.3.2
  - sudo python setup.py install
    
  # Install JPype1
  - cd ~/repos
  - sudo git clone git://github.com/originell/jpype.git
  - cd jpype
  - sudo git reset --hard 50cfd194bb20631feda50fedae41ed18eeca1668
  - sudo python setup.py install
  
# command to run tests, e.g. python setup.py test
script:
  # run tests
  - nosetests -w $TRAVIS_BUILD_DIR
